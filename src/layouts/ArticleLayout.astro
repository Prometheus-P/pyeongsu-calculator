---
import BaseLayout from './BaseLayout.astro';
import AdSlot from '../components/ads/AdSlot.astro';
import BreadcrumbSchema from '../components/seo/BreadcrumbSchema.astro';
import JsonLdScript from '../components/seo/JsonLdScript.astro';

interface Props {
  title: string;
  description: string;
  publishDate: string;
  updateDate?: string;
  canonical?: string;
  ogImage?: string;
  keywords?: string[];
}

const {
  title,
  description,
  publishDate,
  updateDate,
  canonical,
  ogImage,
  keywords = []
} = Astro.props;

const formattedPublishDate = new Date(publishDate).toLocaleDateString('ko-KR', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

const formattedUpdateDate = updateDate
  ? new Date(updateDate).toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    })
  : null;

// Extract page path for breadcrumb
const pagePath = Astro.url.pathname;
const pathParts = pagePath.split('/').filter(Boolean);

// Build breadcrumb items
const breadcrumbItems = [
  { name: '홈', url: '/' },
  { name: '가이드', url: '/guide' },
];

// Add current page if it's not the guide index
if (pathParts.length > 1 && pathParts[1] !== 'index') {
  breadcrumbItems.push({ name: title, url: pagePath });
}

const siteUrl = 'https://pyeongsu-calculator.kr';
---

<BaseLayout
  title={`${title} | 평수 계산기`}
  description={description}
  canonical={canonical}
  ogImage={ogImage}
>
  <Fragment slot="head">
    <meta name="keywords" content={keywords.join(', ')} />
    <meta property="article:published_time" content={publishDate} />
    {updateDate && <meta property="article:modified_time" content={updateDate} />}

    <!-- BlogPosting Schema -->
    <JsonLdScript
      schema={{
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": title,
        "description": description,
        "datePublished": publishDate,
        "dateModified": updateDate || publishDate,
        "author": {
          "@type": "Organization",
          "name": "평수 계산기"
        },
        "publisher": {
          "@type": "Organization",
          "name": "평수 계산기",
          "url": siteUrl
        },
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": canonical || Astro.url.href
        }
      }}
    />

    <!-- Breadcrumb Schema -->
    <BreadcrumbSchema items={breadcrumbItems} />
  </Fragment>

  <main class="min-h-screen bg-m3-surface">
    <div class="container mx-auto px-m3-4 py-m3-8 max-w-4xl">
      <AdSlot format="leaderboard" className="mb-m3-8" />

      <article class="bg-m3-surface-variant/30 rounded-m3-xl shadow-m3-2 p-m3-6 md:p-m3-10">
        <header class="mb-m3-8 pb-m3-6 border-b border-m3-outline-variant">
          <h1 class="text-headline-medium font-bold text-m3-on-surface mb-m3-4 leading-tight">
            {title}
          </h1>
          <div class="flex flex-wrap gap-m3-4 text-label-medium text-m3-on-surface-variant">
            <time datetime={publishDate} class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              작성일: {formattedPublishDate}
            </time>
            {formattedUpdateDate && (
              <time datetime={updateDate} class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                수정일: {formattedUpdateDate}
              </time>
            )}
          </div>
        </header>

        <div class="article-content prose prose-lg dark:prose-invert max-w-none">
          <slot />
        </div>

        <AdSlot format="rectangle" className="my-8" />

        <footer class="mt-m3-10 pt-m3-6 border-t border-m3-outline-variant">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-m3-4">
            <a
              href="/"
              class="inline-flex items-center text-m3-primary hover:underline"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-m3-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
              </svg>
              평수 계산기로 돌아가기
            </a>
            <a
              href="/guide"
              class="inline-flex items-center text-m3-on-surface-variant hover:text-m3-primary"
            >
              다른 가이드 보기
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </a>
          </div>
        </footer>
      </article>

      <AdSlot format="rectangle" className="mt-8" />
    </div>
  </main>
</BaseLayout>

<style is:global>
  .article-content h2 {
    @apply text-title-large font-semibold text-m3-on-surface mt-10 mb-4 pb-2 border-b border-m3-outline-variant;
  }

  .article-content h3 {
    @apply text-title-medium font-medium text-m3-on-surface mt-8 mb-3;
  }

  .article-content p {
    @apply text-m3-on-surface-variant mb-4 leading-relaxed;
  }

  .article-content ul,
  .article-content ol {
    @apply text-m3-on-surface-variant mb-4 pl-6 space-y-2;
  }

  .article-content li {
    @apply leading-relaxed;
  }

  .article-content strong {
    @apply text-m3-on-surface;
  }

  .article-content a {
    @apply text-m3-primary hover:underline;
  }

  .article-content blockquote {
    @apply border-l-4 border-m3-primary pl-4 py-2 my-6 bg-m3-primary-container/30 rounded-r-m3-md;
  }

  .article-content blockquote p {
    @apply text-m3-on-primary-container mb-0;
  }

  .article-content table {
    @apply w-full border-collapse my-6;
  }

  .article-content th,
  .article-content td {
    @apply border border-m3-outline-variant px-4 py-2 text-left;
  }

  .article-content th {
    @apply bg-m3-surface-variant font-semibold text-m3-on-surface;
  }

  .article-content tr:nth-child(even) {
    @apply bg-m3-surface-variant/30;
  }

  .article-content .info-box {
    @apply bg-m3-primary-container/30 border border-m3-primary/30 rounded-m3-md p-6 my-6;
  }

  .article-content .warning-box {
    @apply bg-m3-tertiary-container/30 border border-m3-tertiary/30 rounded-m3-md p-6 my-6;
  }

  .article-content .tip-box {
    @apply bg-m3-secondary-container/30 border border-m3-secondary/30 rounded-m3-md p-6 my-6;
  }
</style>
