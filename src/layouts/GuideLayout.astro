---
/**
 * GuideLayout - Layout for Content Collection guide pages
 * Includes Schema.org JSON-LD for AEO optimization
 */
import type { CollectionEntry } from 'astro:content';
import BaseLayout from './BaseLayout.astro';
import AdSlot from '../components/ads/AdSlot.astro';
import BreadcrumbSchema from '../components/seo/BreadcrumbSchema.astro';
import SchemaMarkup from '../components/seo/SchemaMarkup.astro';
import { generateSchemaGraph } from '../utils/schema';

interface Props {
  guide: CollectionEntry<'guides'>;
}

const { guide } = Astro.props;
const { data, slug } = guide;

// Format dates for display
const formattedPublishDate = data.publishDate.toLocaleDateString('ko-KR', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const formattedUpdateDate = data.updatedDate
  ? data.updatedDate.toLocaleDateString('ko-KR', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    })
  : null;

// Build breadcrumb items
const breadcrumbItems = [
  { name: '홈', url: '/' },
  { name: '가이드', url: '/guide' },
  { name: data.title, url: `/guide/${slug}` },
];

// Generate JSON-LD schema graph
const schemaGraph = generateSchemaGraph(guide);
---

<BaseLayout
  title={`${data.title} | 평수 계산기`}
  description={data.description}
  canonical={data.canonical}
  ogImage={data.ogImage}
>
  <Fragment slot="head">
    <meta name="keywords" content={data.keywords.join(', ')} />
    <meta property="article:published_time" content={data.publishDate.toISOString()} />
    {data.updatedDate && (
      <meta property="article:modified_time" content={data.updatedDate.toISOString()} />
    )}

    <!-- Schema.org JSON-LD for AEO -->
    <SchemaMarkup schemaGraph={schemaGraph} />

    <!-- Breadcrumb Schema -->
    <BreadcrumbSchema items={breadcrumbItems} />
  </Fragment>

  <main class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
      <AdSlot format="leaderboard" className="mb-8" />

      <article class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 md:p-10">
        <header class="mb-8 pb-6 border-b border-gray-200 dark:border-gray-700">
          <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4 leading-tight">
            {data.title}
          </h1>
          <div class="flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400">
            <time datetime={data.publishDate.toISOString()} class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              작성일: {formattedPublishDate}
            </time>
            {formattedUpdateDate && (
              <time datetime={data.updatedDate?.toISOString()} class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                수정일: {formattedUpdateDate}
              </time>
            )}
          </div>
        </header>

        <div class="article-content prose prose-lg dark:prose-invert max-w-none">
          <slot />
        </div>

        <AdSlot format="rectangle" className="my-8" />

        <footer class="mt-10 pt-6 border-t border-gray-200 dark:border-gray-700">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <a
              href="/"
              class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:underline"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
              </svg>
              평수 계산기로 돌아가기
            </a>
            <a
              href="/guide"
              class="inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400"
            >
              다른 가이드 보기
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </a>
          </div>
        </footer>
      </article>

      <AdSlot format="rectangle" className="mt-8" />
    </div>
  </main>
</BaseLayout>

<style is:global>
  .article-content h2 {
    @apply text-2xl font-semibold text-gray-800 dark:text-gray-100 mt-10 mb-4 pb-2 border-b border-gray-200 dark:border-gray-700;
  }

  .article-content h3 {
    @apply text-xl font-medium text-gray-700 dark:text-gray-200 mt-8 mb-3;
  }

  .article-content p {
    @apply text-gray-600 dark:text-gray-300 mb-4 leading-relaxed;
  }

  .article-content ul,
  .article-content ol {
    @apply text-gray-600 dark:text-gray-300 mb-4 pl-6 space-y-2;
  }

  .article-content li {
    @apply leading-relaxed;
  }

  .article-content strong {
    @apply text-gray-800 dark:text-gray-100;
  }

  .article-content a {
    @apply text-blue-600 dark:text-blue-400 hover:underline;
  }

  .article-content blockquote {
    @apply border-l-4 border-blue-500 pl-4 py-2 my-6 bg-blue-50 dark:bg-blue-900/30 rounded-r-lg;
  }

  .article-content blockquote p {
    @apply text-blue-800 dark:text-blue-200 mb-0;
  }

  .article-content table {
    @apply w-full border-collapse my-6;
  }

  .article-content th,
  .article-content td {
    @apply border border-gray-200 dark:border-gray-700 px-4 py-2 text-left;
  }

  .article-content th {
    @apply bg-gray-100 dark:bg-gray-700 font-semibold;
  }

  .article-content tr:nth-child(even) {
    @apply bg-gray-50 dark:bg-gray-800/50;
  }

  .article-content .info-box {
    @apply bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-6 my-6;
  }

  .article-content .warning-box {
    @apply bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6 my-6;
  }

  .article-content .tip-box {
    @apply bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg p-6 my-6;
  }
</style>
