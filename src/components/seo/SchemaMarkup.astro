---
import JsonLdScript from './JsonLdScript.astro';

interface BlogPostingData {
  headline: string;
  description: string;
  datePublished: string;
  dateModified?: string;
  url: string;
}

interface Props {
  type: 'calculator' | 'faq' | 'howto' | 'blogposting' | 'all';
  faqItems?: Array<{ question: string; answer: string }>;
  blogPosting?: BlogPostingData;
  schemaGraph?: any; // Add this line
}

const { type, faqItems = [], blogPosting, schemaGraph } = Astro.props;

const siteUrl = 'https://www.pyeongcalc.kr';

// Organization Schema with credentials
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "PyeongCalc",
  "url": siteUrl,
  "logo": `${siteUrl}/images/og-image.png`,
  "description": "부동산 면적 계산 및 아파트 공간 시뮬레이션 전문 서비스. 정확한 평수-제곱미터 변환과 실제 가구 배치 시뮬레이션을 제공합니다.",
  "foundingDate": "2024",
  "areaServed": "KR",
  "knowsAbout": [
    "부동산 면적 계산",
    "평수-제곱미터 변환",
    "아파트 평형 분석",
    "공간 시뮬레이션",
    "전용면적과 공급면적"
  ],
  "slogan": "평수 계산을 넘어, 공간을 시뮬레이션하세요"
};

// WebApplication Schema
const webAppSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "PyeongCalc 평수 계산기",
  "url": siteUrl,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "All",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "KRW",
  },
  "featureList": [
    "제곱미터 평수 변환",
    "아파트 전용·공급면적 평형표",
    "실평수(발코니 확장) 개념 안내",
  ],
};

// FAQPage Schema
const faqSchema = faqItems.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqItems.map(item => ({
    "@type": "Question",
    "name": item.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": item.answer
    }
  }))
} : null;

// HowTo Schema
const howToSchema = {
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": "평수 계산기 사용 방법",
  "description": "부동산 면적을 평과 제곱미터로 변환하는 방법",
  "totalTime": "PT1M",
  "step": [
    {
      "@type": "HowToStep",
      "name": "면적 입력",
      "text": "평 또는 제곱미터 입력란에 변환하고 싶은 면적을 입력합니다."
    },
    {
      "@type": "HowToStep",
      "name": "자동 변환 확인",
      "text": "입력과 동시에 반대 단위로 자동 변환된 결과를 확인합니다."
    },
    {
      "@type": "HowToStep",
      "name": "빠른 선택 활용",
      "text": "일반적인 아파트 평형(10평, 20평, 30평 등)은 버튼을 클릭하여 빠르게 계산할 수 있습니다."
    }
  ]
};

// BlogPosting Schema with enhanced author credentials
const blogPostingSchema = blogPosting ? {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": blogPosting.headline,
  "description": blogPosting.description,
  "datePublished": blogPosting.datePublished,
  "dateModified": blogPosting.dateModified || blogPosting.datePublished,
  "author": {
    "@type": "Organization",
    "name": "PyeongCalc",
    "url": siteUrl,
    "description": "부동산 면적 계산 및 아파트 공간 시뮬레이션 전문 서비스",
    "knowsAbout": ["부동산 면적 계산", "평수-제곱미터 변환", "아파트 평형 분석"]
  },
  "publisher": {
    "@type": "Organization",
    "name": "PyeongCalc",
    "url": siteUrl,
    "logo": {
      "@type": "ImageObject",
      "url": `${siteUrl}/images/og-image.png`
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": blogPosting.url
  }
} : null;
---

{(type === 'calculator' || type === 'all') && (
  <>
    <JsonLdScript schema={organizationSchema} />
    <JsonLdScript schema={webAppSchema} />
  </>
)}

{(type === 'faq' || type === 'all') && faqSchema && (
  <JsonLdScript schema={faqSchema} />
)}

{(type === 'howto' || type === 'all') && (
  <JsonLdScript schema={howToSchema} />
)}

{type === 'blogposting' && blogPostingSchema && (
  <JsonLdScript schema={blogPostingSchema} />
)}

{schemaGraph && (
  <script type="application/ld+json" set:html={JSON.stringify(schemaGraph)} />
)}
